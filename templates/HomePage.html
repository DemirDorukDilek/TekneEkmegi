{% extends "base.html" %}

{% block title %}Ana Sayfa · Tekne Ekmeği{% endblock %}

{% block content %}

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="flash-message flash-{{ category }}">{{ message }}</div>
{% endfor %}
{% endif %}
{% endwith %}

<div class="card" style="max-width: 600px;">
    <h1>Yakındaki Restoranlar</h1>
    <p class="subtitle">En yakın restoranları listele ve sipariş ver.</p>
    <input type="text" id="filitre" name="filitre" value="">
    <div id="restaurant-list-wrapper">
        {% include "partials/restoran_list.html" %}
    </div>

</div>


<script>
    let filitreTimer = null;

    document.getElementById('filitre').addEventListener('input', function (e) {
        const value = e.target.value;

        // Önceki timer’ı iptal et
        clearTimeout(filitreTimer);

        // 400 ms boyunca yeni tuş gelmezse isteği at
        filitreTimer = setTimeout(function () {
            fetch('/restoranFiltre', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ filitre: value })
            })
            .then(function (res) { return res.text(); })
            .then(function (html) {
                // Sadece liste kısmını yeniliyoruz
                document.getElementById('restaurant-list-wrapper').innerHTML = html;
            })
            .catch(function (err) {
                console.error('Hata:', err);
            });
        }, 400);
    });
</script>

{% endblock %}
